<div id="<%= dom_id(product, :detail) %>"
     data-controller="product-gallery"
     class="w-full">
  <div class="flex flex-col md:flex-row md:gap-6 w-full">
    <div class="w-full md:w-1/2">
      <% if product.images.attached? %>
        <div class="md:flex md:gap-4">
          <!-- Thumbnails (vertical on md+, hidden on mobile) -->
          <div class="hidden md:flex md:flex-col md:gap-2 md:w-20">
            <% product.images.each do |img| %>
              <%= image_tag img.variant(resize_to_limit: [100, 100]),
                    data: {
                      full: url_for(img.variant(resize_to_limit: [700, 700])),
                      action: "click->product-gallery#switch",
                      product_gallery_target: "thumb"
                    },
                    alt: t(".thumb_image_alt", title: product.title),
                    class: "rounded-md w-20 h-20 object-cover border border-gray-200 cursor-pointer hover:opacity-80" %>
            <% end %>
          </div>

          <!-- Main image -->
          <div class="flex-1">
            <%= image_tag product.images.first.variant(resize_to_limit: [1200, 1200]),
                  id: dom_id(product, :main_image),
                  data: { product_gallery_target: "main" },
                  alt: t(".main_image_alt", title: product.title),
                  class: "w-full object-cover rounded-lg border border-gray-200" %>
          </div>
        </div>

        <!-- Thumbnails row (mobile) -->
        <div class="flex md:hidden gap-2 mt-3">
          <% product.images.each do |img| %>
            <%= image_tag img.variant(resize_to_limit: [64, 64]),
                  data: {
                    full: url_for(img.variant(resize_to_limit: [1200, 1200])),
                    action: "click->product-gallery#switch",
                    product_gallery_target: "thumb"
                  },
                  alt: t(".thumb_image_alt", title: product.title),
                  class: "rounded-md w-16 h-16 object-cover border border-gray-200 cursor-pointer hover:opacity-80" %>
          <% end %>
        </div>
      <% else %>
        <%= image_tag "placeholder.png",
              alt: t(".placeholder_image_alt"),
              class: "w-full rounded-lg object-contain border border-gray-200 bg-white" %>
      <% end %>
    </div>

    <div class="w-full md:w-1/2 flex flex-col">
      <h1 class="text-lg md:text-2xl font-bold text-slate-900"><%= product.title %></h1>

      <div class="mt-3 flex items-center justify-between gap-3">
        <span class="text-xl md:text-3xl font-bold text-slate-900">
          Â¥<%= number_to_currency(product.price, unit: "", precision: 0) %>
        </span>
        <%= avatar_for(product.user, size: 42) %>
      </div>

      <%= turbo_frame_tag dom_id(product, :favorite_button) do %>
        <%= render "favorites/button", product: product %>
      <% end %>

      <div class="mt-3">
        <%= form_with url: create_cart_item_path(product),
                      method: :post,
                      local: true,
                      class: "flex items-center gap-2" do |f| %>
          <%= number_field_tag "cart_item[quantity]", 1, min: 1,
                class: "w-20 rounded-md border border-gray-300 px-2 py-1 text-sm
                        focus:outline-none focus:ring-2 focus:ring-orange-500" %>

          <%= f.submit t(".add_to_cart"),
                class: "btn btn-primary" %>
        <% end %>
      </div>

      <!-- Chat -->
      <% if user_signed_in? && current_user != @product.user %>
        <%= button_to t("products.shared.detail.ask_seller"),
              conversations_path,
              method: :post,
              params: {
                product_id:     @product.id,
                participant_id: @product.user.id
              },
              class: "mt-4 inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700" %>

      <% elsif !user_signed_in? %>
        <p class="mt-4 text-sm text-gray-600">
          <%= link_to t("products.shared.detail.sign_in"),
                new_user_session_path,
                class: "text-blue-600 underline" %>
          <%= t("products.shared.detail.ask_prompt") %>
        </p>
      <% end %>

      <p class="mt-4 text-slate-700 leading-5 text-sm md:text-base">
        <%= product.description %>
      </p>

      <div class="mt-3">
        <span class="inline-block rounded px-2 py-0.5 text-xs font-medium bg-slate-100 text-slate-600">
          <%= product.status %>
        </span>
      </div>
    </div>
  </div>
</div>
